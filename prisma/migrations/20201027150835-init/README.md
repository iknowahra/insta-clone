# Migration `20201027150835-init`

This migration has been generated by iknowahra at 10/27/2020, 10:08:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `User` (
`id` int  NOT NULL  AUTO_INCREMENT,
`avatar` varchar(191)  NOT NULL ,
`email` varchar(191)  NOT NULL ,
`userName` varchar(191)  NOT NULL ,
`firstName` varchar(191)  DEFAULT '',
`lastName` varchar(191)  ,
`bio` varchar(191)  ,
`loginSecret` varchar(191)  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
UNIQUE INDEX `User.email_unique`(`email`),
UNIQUE INDEX `User.userName_unique`(`userName`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Post` (
`id` int  NOT NULL  AUTO_INCREMENT,
`location` varchar(191)  ,
`caption` varchar(191)  NOT NULL ,
`userId` int  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Like` (
`id` int  NOT NULL  AUTO_INCREMENT,
`userId` int  NOT NULL ,
`postId` int  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Comment` (
`id` int  NOT NULL  AUTO_INCREMENT,
`text` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`userId` int  NOT NULL ,
`postId` int  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `File` (
`id` int  NOT NULL  AUTO_INCREMENT,
`url` varchar(191)  NOT NULL ,
`postId` int  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Room` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Message` (
`id` int  NOT NULL  AUTO_INCREMENT,
`text` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL ,
`fromUserId` int  NOT NULL ,
`toUserId` int  NOT NULL ,
`roomId` int  NOT NULL ,
UNIQUE INDEX `Message_fromUserId_unique`(`fromUserId`),
UNIQUE INDEX `Message_toUserId_unique`(`toUserId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_RoomToUser` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_RoomToUser_AB_unique`(`A`,
`B`),
INDEX `_RoomToUser_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_FollowRelation` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_FollowRelation_AB_unique`(`A`,
`B`),
INDEX `_FollowRelation_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Post` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Like` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Like` ADD FOREIGN KEY (`postId`) REFERENCES `Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Comment` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Comment` ADD FOREIGN KEY (`postId`) REFERENCES `Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `File` ADD FOREIGN KEY (`postId`) REFERENCES `Post`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`fromUserId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`toUserId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Message` ADD FOREIGN KEY (`roomId`) REFERENCES `Room`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoomToUser` ADD FOREIGN KEY (`A`) REFERENCES `Room`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_RoomToUser` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_FollowRelation` ADD FOREIGN KEY (`A`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_FollowRelation` ADD FOREIGN KEY (`B`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201027150835-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,95 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+    provider = "mysql"
+    url = "***"
+}
+
+generator client {
+    provider = "prisma-client-js"
+}
+
+model User {
+    id          Int       @id @default(autoincrement())
+    avatar      String
+    email       String    @unique
+    userName    String    @unique
+    firstName    String?   @default("")
+    lastName    String?
+    bio         String?
+    posts       Post[]
+    likes       Like[]
+    comments    Comment[]
+    rooms       Room[]
+    loginSecret String?
+    followers   User[]    @relation("FollowRelation")
+    following   User[]    @relation("FollowRelation")
+    sender      Message   @relation("from")
+    receiver    Message   @relation("to")
+    createdAt   DateTime  @default(now())
+    updatedAt   DateTime  @default(now()) @updatedAt
+}
+
+model Post {
+    id        Int       @id @default(autoincrement())
+    location  String?
+    caption   String
+    user      User      @relation(fields: [userId], references: [id])
+    userId    Int
+    files     File[]
+    likes     Like[]
+    comments  Comment[]
+    createdAt DateTime  @default(now())
+    updatedAt DateTime  @updatedAt
+}
+
+model Like {
+    id        Int      @id @default(autoincrement())
+    user      User     @relation(fields: [userId], references: [id])
+    post      Post     @relation(fields: [postId], references: [id])
+    userId    Int
+    postId    Int
+    createdAt DateTime @default(now())
+    updatedAt DateTime @updatedAt
+}
+
+model Comment {
+    id        Int      @id @default(autoincrement())
+    text      String
+    user      User     @relation(fields: [userId], references: [id])
+    post      Post     @relation(fields: [postId], references: [id])
+    createdAt DateTime @default(now())
+    updatedAt DateTime @updatedAt
+    userId    Int
+    postId    Int
+}
+
+model File {
+    id     Int    @id @default(autoincrement())
+    url    String
+    post   Post   @relation(fields: [postId], references: [id])
+    postId Int
+}
+
+model Room {
+    id           Int       @id @default(autoincrement())
+    participants User[]
+    messages     Message[]
+    createdAt    DateTime  @default(now())
+    updatedAt    DateTime  @updatedAt
+}
+
+model Message {
+    id         Int      @id @default(autoincrement())
+    text       String
+    from       User     @relation("from", fields: [fromUserId], references: [id])
+    to         User     @relation("to", fields: [toUserId], references: [id])
+    room       Room     @relation(fields: [roomId], references: [id])
+    createdAt  DateTime @default(now())
+    updatedAt  DateTime @updatedAt
+    fromUserId Int
+    toUserId   Int
+    roomId     Int
+}
+
```


